<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>لوحة التحكم - الأدوات</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <script>
    if (localStorage.getItem("loggedIn") !== "true") {
      window.location.href = "usr.html";
    }
  </script>

  <header>
    <h1>🎛️ لوحة إدارة الأدوات</h1>
    <p>أضف أدوات جديدة إلى المتجر</p>
    <button onclick="logout()">🔒 تسجيل الخروج</button>
  </header>

  <main>
    <section class="form-section">
      <input type="text" id="tool-name" placeholder="اسم الأداة" />
      <input type="text" id="tool-link" placeholder="رابط الأداة" />
      <button onclick="addTool()">➕ إضافة الأداة</button>
    </section>

    <section id="tools-preview" class="tools-container"></section>
  </main>

  <footer>
    <p>حقوق النشر © 2025 - MR-PIIP_PRO</p>
  </footer>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import { firebaseConfig } from './firebase-config.js';

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.logout = function () {
      localStorage.removeItem("loggedIn");
      window.location.href = "usr.html";
    };

    window.addTool = async function () {
      const name = document.getElementById("tool-name").value.trim();
      const link = document.getElementById("tool-link").value.trim();
      if (!name || !link) return alert("يرجى تعبئة جميع الحقول.");

      try {
        await addDoc(collection(db, "tools"), {
          name,
          link,
          added_at: serverTimestamp()
        });
        alert("✅ تمت إضافة الأداة بنجاح");
        document.getElementById("tool-name").value = "";
        document.getElementById("tool-link").value = "";
        loadPreview();
      } catch (e) {
        console.error("خطأ في الإضافة:", e);
        alert("❌ فشل في إضافة الأداة");
      }
    };

    async function loadPreview() {
      const container = document.getElementById("tools-preview");
      container.innerHTML = "⏳ تحميل الأدوات...";
      const q = query(collection(db, "tools"), orderBy("added_at", "desc"));
      const snapshot = await getDocs(q);
      container.innerHTML = "";

      snapshot.forEach(doc => {
        const tool = doc.data();
        const card = document.createElement("div");
        card.className = "tool-card";
        card.innerHTML = `<h3>${tool.name}</h3><a href="${tool.link}" target="_blank">رابط الأداة</a>`;
        container.appendChild(card);
      });
    }

    loadPreview();
  </script>
</body>
</html>
