<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ููุญุฉ ุงูุชุญูู - ุงูุฃุฏูุงุช</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>๐๏ธ ููุญุฉ ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุช</h1>
    <p>ุฃุถู ุฃุฏูุงุช ุฌุฏูุฏุฉ ุฅูู ุงููุชุฌุฑ</p>
    <p id="user-info">ุฌุงุฑ ุงูุชุญูู ูู ุงููุณุชุฎุฏู...</p>
    <button onclick="logout()">๐ ุชุณุฌูู ุงูุฎุฑูุฌ</button>
  </header>

  <main>
    <section class="form-section">
      <input type="text" id="tool-name" placeholder="ุงุณู ุงูุฃุฏุงุฉ" />
      <input type="text" id="tool-link" placeholder="ุฑุงุจุท ุงูุฃุฏุงุฉ" />
      <button onclick="addTool()">โ ุฅุถุงูุฉ ุงูุฃุฏุงุฉ</button>
    </section>

    <section id="tools-preview" class="tools-container"></section>
  </main>

  <footer>
    <p>ุญููู ุงููุดุฑ ยฉ 2025 - MR-PIIP_PRO</p>
  </footer>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { firebaseConfig } from './firebase-config.js';

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const userInfo = document.getElementById("user-info");

    // ุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ููู ุตูุงุญูุงุช ุงูุฃุฏูู
    onAuthStateChanged(auth, user => {
      if (!user) {
        alert("ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู.");
        window.location.href = "usr.html";
      } else if (user.email !== "ossamapiip000@gmail.com") {
        alert("๐ซ ููุณ ูุฏูู ุตูุงุญูุงุช ุงูุฏุฎูู ุฅูู ููุญุฉ ุงูุฅุฏุงุฑุฉ.");
        signOut(auth).then(() => {
          window.location.href = "usr.html";
        });
      } else {
        userInfo.textContent = `ูุฑุญุจูุง ${user.email}`;
        loadPreview();
      }
    });

    // ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ
    window.logout = function () {
      signOut(auth).then(() => {
        window.location.href = "usr.html";
      });
    };

    // ุฅุถุงูุฉ ุฃุฏุงุฉ ุฌุฏูุฏุฉ
    window.addTool = async function () {
      const name = document.getElementById("tool-name").value.trim();
      const link = document.getElementById("tool-link").value.trim();
      if (!name || !link) return alert("ูุฑุฌู ุชุนุจุฆุฉ ุฌููุน ุงูุญููู.");

      try {
        await addDoc(collection(db, "tools"), {
          name,
          link,
          added_at: serverTimestamp()
        });
        alert("โ ุชูุช ุงูุฅุถุงูุฉ ุจูุฌุงุญ");
        document.getElementById("tool-name").value = "";
        document.getElementById("tool-link").value = "";
        loadPreview();
      } catch (error) {
        console.error("ูุดู ุงูุฅุถุงูุฉ:", error);
        alert("โ ูุดู ูู ุงูุฅุถุงูุฉ");
      }
    };

    // ุนุฑุถ ุงูุฃุฏูุงุช ุงูุญุงููุฉ
    async function loadPreview() {
      const previewContainer = document.getElementById("tools-preview");
      previewContainer.innerHTML = "ุฌุงุฑู ุงูุชุญููู...";

      const q = query(collection(db, "tools"), orderBy("added_at", "desc"));
      const snapshot = await getDocs(q);

      previewContainer.innerHTML = "";
      snapshot.forEach(doc => {
        const tool = doc.data();
        const div = document.createElement("div");
        div.className = "tool-card";
        div.innerHTML = `<h3>${tool.name}</h3><a href="${tool.link}" target="_blank">ุฑุงุจุท ุงูุฃุฏุงุฉ</a>`;
        previewContainer.appendChild(div);
      });
    }
  </script>
</body>
</html>
