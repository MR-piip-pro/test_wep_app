<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ø£Ø¯ÙˆØ§Øª</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Øª</h1>
    <p>Ø£Ø¶Ù Ø£Ø¯ÙˆØ§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø±</p>
    <p id="user-info">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...</p>
    <button onclick="logout()">ğŸ”’ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </header>

  <main>
    <section class="form-section">
      <input type="text" id="tool-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ø§Ø©" />
      <input type="text" id="tool-link" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø¯Ø§Ø©" />
      <button onclick="addTool()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¯Ø§Ø©</button>
    </section>

    <section id="tools-preview" class="tools-container"></section>
  </main>

  <footer>
    <p>Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± Â© 2025 - MR-PIIP_PRO</p>
  </footer>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, updateDoc, doc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { firebaseConfig } from './firebase-config.js';

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const userInfo = document.getElementById("user-info");

    // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆÙ…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù†
    onAuthStateChanged(auth, user => {
      if (!user) {
        alert("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
        window.location.href = "usr.html";
      } else if (user.email !== "ossamapiip000@gmail.com") {
        alert("ğŸš« Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.");
        signOut(auth).then(() => {
          window.location.href = "usr.html";
        });
      } else {
        userInfo.textContent = `Ù…Ø±Ø­Ø¨Ù‹Ø§ ${user.email}`;
        loadPreview();
      }
    });

    // Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    window.logout = function () {
      signOut(auth).then(() => {
        window.location.href = "usr.html";
      });
    };

    // Ø¥Ø¶Ø§ÙØ© Ø£Ø¯Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø©
    window.addTool = async function () {
      const name = document.getElementById("tool-name").value.trim();
      const link = document.getElementById("tool-link").value.trim();
      if (!name || !link) return alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.");

      try {
        await addDoc(collection(db, "tools"), {
          name,
          link,
          added_at: serverTimestamp()
        });
        alert("âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­");
        document.getElementById("tool-name").value = "";
        document.getElementById("tool-link").value = "";
        loadPreview();
      } catch (error) {
        console.error("ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©:", error);
        alert("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
      }
    };

    // ğŸ—‘ï¸ Ø­Ø°Ù Ø£Ø¯Ø§Ø©
    window.deleteTool = async function (id) {
      if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø©ØŸ")) {
        await deleteDoc(doc(db, "tools", id));
        loadPreview();
      }
    };

    // âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø£Ø¯Ø§Ø©
    window.editTool = async function (id, oldName, oldLink) {
      const newName = prompt("âœï¸ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:", oldName);
      const newLink = prompt("ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯:", oldLink);
      if (!newName || !newLink) return;

      await updateDoc(doc(db, "tools", id), {
        name: newName.trim(),
        link: newLink.trim()
      });
      loadPreview();
    };

    // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    async function loadPreview() {
      const previewContainer = document.getElementById("tools-preview");
      previewContainer.innerHTML = "Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

      const q = query(collection(db, "tools"), orderBy("added_at", "desc"));
      const snapshot = await getDocs(q);

      previewContainer.innerHTML = "";
      snapshot.forEach(docSnap => {
  const tool = docSnap.data();
  const id = docSnap.id;

  const safeName = encodeURIComponent(tool.name);
  const safeLink = encodeURIComponent(tool.link);

  const div = document.createElement("div");
  div.className = "tool-card";
  div.innerHTML = `
    <h3>${tool.name}</h3>
    <a href="${tool.link}" target="_blank">Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø¯Ø§Ø©</a><br/>
    <button onclick="editTool('${id}', decodeURIComponent('${safeName}'), decodeURIComponent('${safeLink}'))">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
    <button onclick="deleteTool('${id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
  `;
  previewContainer.appendChild(div);
});

    }
  </script>
</body>
</html>

