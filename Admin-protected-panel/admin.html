<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ø£Ø¯ÙˆØ§Øª</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <script>
    if (localStorage.getItem("loggedIn") !== "true") {
      window.location.href = "usr.html";
    }
  </script>

  <header>
    <h1>ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Øª</h1>
    <p>Ø£Ø¶Ù Ø£Ø¯ÙˆØ§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø±</p>
    <button onclick="logout()">ğŸ”’ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </header>

  <main>
    <section class="form-section">
      <input type="text" id="tool-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ø§Ø©" />
      <input type="text" id="tool-link" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø¯Ø§Ø©" />
      <button onclick="addTool()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¯Ø§Ø©</button>
    </section>

    <section id="tools-preview" class="tools-container"></section>
  </main>

  <footer>
    <p>Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± Â© 2025 - MR-PIIP_PRO</p>
  </footer>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import { firebaseConfig } from './firebase-config.js';

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.logout = function () {
      localStorage.removeItem("loggedIn");
      window.location.href = "usr.html";
    };

    window.addTool = async function () {
      const name = document.getElementById("tool-name").value.trim();
      const link = document.getElementById("tool-link").value.trim();
      if (!name || !link) return alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.");

      try {
        await addDoc(collection(db, "tools"), {
          name,
          link,
          added_at: serverTimestamp()
        });
        alert("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¯Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­");
        document.getElementById("tool-name").value = "";
        document.getElementById("tool-link").value = "";
        loadPreview();
      } catch (e) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©:", e);
        alert("âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¯Ø§Ø©");
      }
    };

    async function loadPreview() {
      const container = document.getElementById("tools-preview");
      container.innerHTML = "â³ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¯ÙˆØ§Øª...";
      const q = query(collection(db, "tools"), orderBy("added_at", "desc"));
      const snapshot = await getDocs(q);
      container.innerHTML = "";

      snapshot.forEach(doc => {
        const tool = doc.data();
        const card = document.createElement("div");
        card.className = "tool-card";
        card.innerHTML = `<h3>${tool.name}</h3><a href="${tool.link}" target="_blank">Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø¯Ø§Ø©</a>`;
        container.appendChild(card);
      });
    }

    loadPreview();
  </script>
</body>
</html>
